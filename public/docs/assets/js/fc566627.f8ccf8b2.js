"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[282],{8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>d});var s=r(6540);const o={},i=s.createContext(o);function a(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:n},e.children)}},9551:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"integrations/webhooks","title":"Documentaci\xf3n de Webhooks","description":"Los webhooks te permiten recibir notificaciones en tiempo real cuando ocurren eventos en el sistema.","source":"@site/docs/integrations/webhooks.md","sourceDirName":"integrations","slug":"/integrations/webhooks","permalink":"/docs/integrations/webhooks","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/integrations/webhooks.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3}}');var o=r(4848),i=r(8453);const a={sidebar_position:3},d="Documentaci\xf3n de Webhooks",t={},c=[{value:"Configurar Webhooks",id:"configurar-webhooks",level:2},{value:"Crear Webhook",id:"crear-webhook",level:3},{value:"Eventos Disponibles",id:"eventos-disponibles",level:3},{value:"Eventos de Stock",id:"eventos-de-stock",level:4},{value:"Eventos de Finance",id:"eventos-de-finance",level:4},{value:"Eventos de Services",id:"eventos-de-services",level:4},{value:"Eventos de Usuarios",id:"eventos-de-usuarios",level:4},{value:"Estructura de Webhook",id:"estructura-de-webhook",level:2},{value:"Payload de Ejemplo",id:"payload-de-ejemplo",level:3},{value:"Headers de Webhook",id:"headers-de-webhook",level:3},{value:"Verificar Webhooks",id:"verificar-webhooks",level:2},{value:"Verificaci\xf3n de Firma",id:"verificaci\xf3n-de-firma",level:3},{value:"Ejemplo en Node.js",id:"ejemplo-en-nodejs",level:3},{value:"Manejo de Errores",id:"manejo-de-errores",level:2},{value:"Reintentos Autom\xe1ticos",id:"reintentos-autom\xe1ticos",level:3},{value:"C\xf3digos de Estado",id:"c\xf3digos-de-estado",level:3},{value:"Configurar Webhooks",id:"configurar-webhooks-1",level:2},{value:"Configuraci\xf3n B\xe1sica",id:"configuraci\xf3n-b\xe1sica",level:3},{value:"Configuraci\xf3n Avanzada",id:"configuraci\xf3n-avanzada",level:3},{value:"Monitorear Webhooks",id:"monitorear-webhooks",level:2},{value:"Estado de Webhooks",id:"estado-de-webhooks",level:3},{value:"Logs de Webhooks",id:"logs-de-webhooks",level:3},{value:"Ejemplos de Implementaci\xf3n",id:"ejemplos-de-implementaci\xf3n",level:2},{value:"PHP",id:"php",level:3},{value:"Python",id:"python",level:3},{value:"Consejos para Webhooks",id:"consejos-para-webhooks",level:2},{value:"Mejores Pr\xe1cticas",id:"mejores-pr\xe1cticas",level:3}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"documentaci\xf3n-de-webhooks",children:"Documentaci\xf3n de Webhooks"})}),"\n",(0,o.jsx)(n.p,{children:"Los webhooks te permiten recibir notificaciones en tiempo real cuando ocurren eventos en el sistema."}),"\n",(0,o.jsx)(n.h2,{id:"configurar-webhooks",children:"Configurar Webhooks"}),"\n",(0,o.jsx)(n.h3,{id:"crear-webhook",children:"Crear Webhook"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-http",children:'POST /api/webhooks\r\nContent-Type: application/json\r\n\r\n{\r\n  "url": "https://tu-servidor.com/webhook",\r\n  "events": ["product.created", "product.updated"],\r\n  "secret": "tu_secreto_webhook"\r\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"eventos-disponibles",children:"Eventos Disponibles"}),"\n",(0,o.jsx)(n.h4,{id:"eventos-de-stock",children:"Eventos de Stock"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"product.created"}),": Producto creado"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"product.updated"}),": Producto actualizado"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"product.deleted"}),": Producto eliminado"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"stock.low"}),": Stock bajo"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"stock.out"}),": Stock agotado"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"eventos-de-finance",children:"Eventos de Finance"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"transaction.created"}),": Transacci\xf3n creada"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"payment.received"}),": Pago recibido"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"payment.overdue"}),": Pago vencido"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"eventos-de-services",children:"Eventos de Services"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"service.created"}),": Servicio creado"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"service.completed"}),": Servicio completado"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"service.cancelled"}),": Servicio cancelado"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"eventos-de-usuarios",children:"Eventos de Usuarios"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"user.created"}),": Usuario creado"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"user.updated"}),": Usuario actualizado"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"user.deleted"}),": Usuario eliminado"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"estructura-de-webhook",children:"Estructura de Webhook"}),"\n",(0,o.jsx)(n.h3,{id:"payload-de-ejemplo",children:"Payload de Ejemplo"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "event": "product.created",\r\n  "timestamp": "2024-01-15T10:30:00Z",\r\n  "data": {\r\n    "id": 1,\r\n    "name": "Nuevo Producto",\r\n    "code": "PROD001",\r\n    "category": "Categor\xeda 1",\r\n    "stock": 100,\r\n    "price": 25.50\r\n  },\r\n  "metadata": {\r\n    "user_id": 1,\r\n    "ip_address": "192.168.1.1",\r\n    "user_agent": "Mozilla/5.0..."\r\n  }\r\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"headers-de-webhook",children:"Headers de Webhook"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-http",children:"X-Webhook-Event: product.created\r\nX-Webhook-Timestamp: 2024-01-15T10:30:00Z\r\nX-Webhook-Signature: sha256=abc123...\r\nContent-Type: application/json\n"})}),"\n",(0,o.jsx)(n.h2,{id:"verificar-webhooks",children:"Verificar Webhooks"}),"\n",(0,o.jsx)(n.h3,{id:"verificaci\xf3n-de-firma",children:"Verificaci\xf3n de Firma"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const crypto = require('crypto');\r\n\r\nfunction verifyWebhook(payload, signature, secret) {\r\n  const expectedSignature = crypto\r\n    .createHmac('sha256', secret)\r\n    .update(payload)\r\n    .digest('hex');\r\n  \r\n  return signature === `sha256=${expectedSignature}`;\r\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"ejemplo-en-nodejs",children:"Ejemplo en Node.js"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const express = require('express');\r\nconst crypto = require('crypto');\r\n\r\napp.post('/webhook', (req, res) => {\r\n  const signature = req.headers['x-webhook-signature'];\r\n  const payload = JSON.stringify(req.body);\r\n  const secret = process.env.WEBHOOK_SECRET;\r\n  \r\n  if (!verifyWebhook(payload, signature, secret)) {\r\n    return res.status(401).send('Invalid signature');\r\n  }\r\n  \r\n  const { event, data } = req.body;\r\n  \r\n  switch (event) {\r\n    case 'product.created':\r\n      handleProductCreated(data);\r\n      break;\r\n    case 'product.updated':\r\n      handleProductUpdated(data);\r\n      break;\r\n    default:\r\n      console.log('Unknown event:', event);\r\n  }\r\n  \r\n  res.status(200).send('OK');\r\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"manejo-de-errores",children:"Manejo de Errores"}),"\n",(0,o.jsx)(n.h3,{id:"reintentos-autom\xe1ticos",children:"Reintentos Autom\xe1ticos"}),"\n",(0,o.jsx)(n.p,{children:"El sistema reintenta autom\xe1ticamente los webhooks fallidos:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Primer reintento"}),": 1 minuto despu\xe9s"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Segundo reintento"}),": 5 minutos despu\xe9s"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Tercer reintento"}),": 15 minutos despu\xe9s"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Cuarto reintento"}),": 1 hora despu\xe9s"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"M\xe1ximo"}),": 4 reintentos"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"c\xf3digos-de-estado",children:"C\xf3digos de Estado"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"200 OK"}),": Webhook procesado exitosamente"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"400 Bad Request"}),": Payload malformado"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"401 Unauthorized"}),": Firma inv\xe1lida"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"500 Internal Server Error"}),": Error del servidor"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"configurar-webhooks-1",children:"Configurar Webhooks"}),"\n",(0,o.jsx)(n.h3,{id:"configuraci\xf3n-b\xe1sica",children:"Configuraci\xf3n B\xe1sica"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-http",children:'POST /api/webhooks\r\nContent-Type: application/json\r\n\r\n{\r\n  "url": "https://tu-servidor.com/webhook",\r\n  "events": ["product.created"],\r\n  "secret": "tu_secreto_webhook",\r\n  "active": true\r\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"configuraci\xf3n-avanzada",children:"Configuraci\xf3n Avanzada"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-http",children:'POST /api/webhooks\r\nContent-Type: application/json\r\n\r\n{\r\n  "url": "https://tu-servidor.com/webhook",\r\n  "events": ["product.created", "product.updated"],\r\n  "secret": "tu_secreto_webhook",\r\n  "active": true,\r\n  "retry_count": 3,\r\n  "timeout": 30,\r\n  "headers": {\r\n    "X-Custom-Header": "valor_personalizado"\r\n  }\r\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"monitorear-webhooks",children:"Monitorear Webhooks"}),"\n",(0,o.jsx)(n.h3,{id:"estado-de-webhooks",children:"Estado de Webhooks"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-http",children:"GET /api/webhooks\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Respuesta:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "success": true,\r\n  "data": [\r\n    {\r\n      "id": 1,\r\n      "url": "https://tu-servidor.com/webhook",\r\n      "events": ["product.created"],\r\n      "active": true,\r\n      "last_delivery": "2024-01-15T10:30:00Z",\r\n      "success_count": 100,\r\n      "failure_count": 5\r\n    }\r\n  ]\r\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"logs-de-webhooks",children:"Logs de Webhooks"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-http",children:"GET /api/webhooks/1/logs\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Respuesta:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "success": true,\r\n  "data": [\r\n    {\r\n      "id": 1,\r\n      "event": "product.created",\r\n      "status": "success",\r\n      "timestamp": "2024-01-15T10:30:00Z",\r\n      "response_code": 200,\r\n      "response_time": 150\r\n    }\r\n  ]\r\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"ejemplos-de-implementaci\xf3n",children:"Ejemplos de Implementaci\xf3n"}),"\n",(0,o.jsx)(n.h3,{id:"php",children:"PHP"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"<?php\r\nfunction verifyWebhook($payload, $signature, $secret) {\r\n    $expectedSignature = hash_hmac('sha256', $payload, $secret);\r\n    return hash_equals($signature, \"sha256={$expectedSignature}\");\r\n}\r\n\r\n$payload = file_get_contents('php://input');\r\n$signature = $_SERVER['HTTP_X_WEBHOOK_SIGNATURE'];\r\n$secret = $_ENV['WEBHOOK_SECRET'];\r\n\r\nif (!verifyWebhook($payload, $signature, $secret)) {\r\n    http_response_code(401);\r\n    exit('Invalid signature');\r\n}\r\n\r\n$data = json_decode($payload, true);\r\n$event = $data['event'];\r\n\r\nswitch ($event) {\r\n    case 'product.created':\r\n        handleProductCreated($data['data']);\r\n        break;\r\n    default:\r\n        error_log(\"Unknown event: {$event}\");\r\n}\r\n\r\nhttp_response_code(200);\r\necho 'OK';\r\n?>\n"})}),"\n",(0,o.jsx)(n.h3,{id:"python",children:"Python"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import hashlib\r\nimport hmac\r\nimport json\r\nfrom flask import Flask, request\r\n\r\napp = Flask(__name__)\r\n\r\ndef verify_webhook(payload, signature, secret):\r\n    expected_signature = hmac.new(\r\n        secret.encode(),\r\n        payload.encode(),\r\n        hashlib.sha256\r\n    ).hexdigest()\r\n    return hmac.compare_digest(signature, f\"sha256={expected_signature}\")\r\n\r\n@app.route('/webhook', methods=['POST'])\r\ndef webhook():\r\n    payload = request.get_data()\r\n    signature = request.headers.get('X-Webhook-Signature')\r\n    secret = os.environ.get('WEBHOOK_SECRET')\r\n    \r\n    if not verify_webhook(payload, signature, secret):\r\n        return 'Invalid signature', 401\r\n    \r\n    data = request.get_json()\r\n    event = data['event']\r\n    \r\n    if event == 'product.created':\r\n        handle_product_created(data['data'])\r\n    \r\n    return 'OK', 200\n"})}),"\n",(0,o.jsx)(n.h2,{id:"consejos-para-webhooks",children:"Consejos para Webhooks"}),"\n",(0,o.jsx)(n.h3,{id:"mejores-pr\xe1cticas",children:"Mejores Pr\xe1cticas"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Verifica firmas"}),": Siempre verifica la firma del webhook"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Maneja errores"}),": Implementa manejo robusto de errores"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Procesa as\xedncronamente"}),": Usa colas para procesar webhooks"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Mant\xe9n logs"}),": Registra todas las actividades"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Monitorea rendimiento"}),": Supervisa el rendimiento de webhooks"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Usa HTTPS"}),": Siempre usa conexiones seguras"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Valida datos"}),": Valida los datos recibidos"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}}}]);